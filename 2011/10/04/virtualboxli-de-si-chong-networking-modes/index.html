<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>VirtualBox里的四种networking modes | 时光屋</title>
  <meta name="author" content="Villa Dora">
  
  <meta name="description" content="装了个virtualbox，现在的机器性能估计还可以带起2-3台虚拟机，装了个archlinux加个win8 折腾了半天了；虽然原来弄过虚拟机，知道bridge adapter这种模式最好但是并不了解具体的几种mode下的区别，今天学习了来分享下。">
  
  
  <meta name="viewport" content="width=device-width; initial-scale=1; maximum-scale=1">

  <meta property="og:title" content="VirtualBox里的四种networking modes"/>
  <meta property="og:site_name" content="时光屋"/>

  <link rel="alternate" href="atom.xml" title="时光屋" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8/jquery.min.js"></script>
  
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-7622998-2']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>

</head>

<body>
  <header id="header" class="inner"><div class="alignleft">
  <!--<h1><a href="/">时光屋</a></h1>-->

  <div id="contenedor">
  <ul class="cube">
    <li class="cara">
        时光屋
    </li>
    <li class="cara"></li>
    <li class="cara"></li>
    <li class="cara"></li>
    <li class="cara"></li>
    <li class="cara">
    Villadora
    </li>
  </ul>
</div>

<script type="text/javascript">
	$(function(){

		var cube = $('.cube'),
				offset = $('#contenedor').offset(),
				offsetleft = (offset.left + 100),
				offsettop = (offset.top + 100);

		cube.on({
			mousemove: function(e) {
				$(this).css('transform','rotateX(' + (e.pageY - offsettop) + 'deg) rotateY(' + (e.pageX - offsetleft) + 'deg)');
				$(this).addClass('noanimar').removeClass('animar');
			},
			mouseout: function() {
				$(this).css('transform','rotateX(0deg) rotateY(0deg)');
				$(this).addClass('animar').removeClass('noanimar');
			}
		});

		//console.log('x=' + offsetleft + ', y=' + offsettop);
});
</script>
<script src="/js/prefixfree.min.js"></script>

</div>
<nav id="main-nav" class="alignright">
  <ul>
    
      <li><a href="/">Home</a></li>
    
      <li><a href="/archives">Archives</a></li>
    
  </ul>
  <div class="clearfix"></div>
</nav>


<div class="clearfix"></div></header>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper"><article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2011-10-04T04:14:00.000Z">10月 4 2011</time>
      
      
  
    <h1 class="title">VirtualBox里的四种networking modes</h1>
  

    </header>
    <div class="entry">
      
        <p>装了个virtualbox，现在的机器性能估计还可以带起2-3台虚拟机，装了个archlinux加个win8 折腾了半天了；虽然原来弄过虚拟机，知道bridge adapter这种模式最好但是并不了解具体的几种mode下的区别，今天学习了来分享下。</p>
<a id="more"></a>

<h2 id="NAT">NAT</h2>
<p>Network Address Transaction，主要是将虚拟机的虚拟网络地址转化成现实网络中的可用地址，主要有三种形式：静态转换Static Nat、动态转换Dynamic Nat 和端口多路复用OverLoad。</p>
<p>静态转换和动态转换，顾名思义，就是转化地址映射表是静态还是动态的区别。而虚拟机实现的方式是端口多路复用，也就是说host machine的地址: ip1:port1, guest machine的地址ip2：port1在通过host machine的NAT转换后就变成了ip1:port2，从而与外界网络交流。</p>
<p>这样的情形下，对于外界的网络而言，是不知道ip1:port2的包到底是guest machine发出来的还是host machine发出来的，自然也就无法去访问guest machine，从而这样的NAT实现的网络是单向的：虚拟机可以访问外部网络，而主机和其他虚拟机都无法访问虚拟机。</p>
<p>如果在这个模式下实现相互访问，那么就得用到端口映射了，用过emule的同学都知道，为了使局域网内的ip也能够被ED2K网络上其他用户检测到，实现文件共享，那么就要在路由上做端口映射，使得路由器知道，在这个端口上受到的包都转发给特定的ip；在这里也是一样的，既设置规则，对于所有的port2端口受到的package都转发给ip2:port1既虚拟机的网络地址，外部网络就能够通过这样一个隧道来和虚拟机交互了。</p>
<h2 id="Bridged_Adapter">Bridged Adapter</h2>
<p>也就是通常说的桥接，这个模式是需要设备驱动支持，所以在virtualBox的document上就写明了：<br>On Macintosh hosts, functionality is limited when using AirPort (the Mac’s wireless networking) for bridged networking. Currently, VirtualBox supports only IPv4 over AirPort. For other protocols such as IPv6 and IPX, you must choose a wired interface.</p>
<p>On Linux hosts, functionality is limited when using wireless interfaces for bridged networking. Currently, VirtualBox supports only IPv4 over wireless. For other protocols such as IPv6 and IPX, you must choose a wired interface.</p>
<p>On Solaris hosts, there is no support for using wireless interfaces. Filtering guest traffic using IPFilter is also not completely supported due to technical restrictions of the Solaris networking subsystem. These issues would be addressed in a future release of Solaris 11.</p>
<p>可以看到在以上系统中，在host使用无线网卡连接到internet时，有些是限制了协议，solaris干脆就不支持。</p>
<p>这是因为，bridged adapter是通过调用了网络驱动上的filter的功能，对network driver发出去的data都进行了intercept，从而区别通过网卡的data到底是传向host的还是guest，对于外部网络来说这个网卡实际上背后是有两个地址。而对于虚拟机来说就是通过主机的网卡搭了一座通往外界的桥。</p>
<p>由于virtualBox参与了网卡上包的处理，当接收到地址为虚拟机地址的data时，正常情况是主机并不知道这个地址，于是ignore掉，而当virtualBox发现这个包是属于虚拟机的地址，于是截获发向虚拟机的虚拟network interface。这样对于外界来说，这里存在的是两台独立的机器，而对于host和guest来说，他们是平等的在同一个子网内，因此可以互相访问，和正常的机器一样。</p>
<h2 id="Internal">Internal</h2>
<p>顾名思义，就是内部网络，virtualBox等于提供了一个虚拟交换机，配置了internal的虚拟机发送的package都通过这个虚拟的交换机，而这个路由是和外部的网络，host机器都没有关系的；于是只有在同一个internal ID网络下的虚拟机之间可以互相访问。</p>
<p>这样，这些虚拟机之间的相互交互的data就完全不通过物理网络接口，安全性得到了提高。</p>
<h2 id="Host_Only">Host Only</h2>
<p>有点类似于bridged adapter和internal的混合体，虚拟机之间是通过internal mode相互连接访问，而virtualBox会在host上建立一个软件“loopback” interface，而虚拟机就通过这个接口作为与host之间交流的通道。如同建立了在这个接口上建立了一个新的子网，而所有的虚拟机都在这个子网上。</p>
<p>不通的modes之间的连通性关系如下图:</p>
<img src="http://farm9.staticflickr.com/8282/7567975632_51c1805750.jpg">


      
    </div>
    <footer>
      
        
  
  <div class="categories">
    
  </div>

        
  
  <div class="tags">
    <a href="/tags/虚拟机/">虚拟机</a>, <a href="/tags/virtualbox/">virtualbox</a>, <a href="/tags/网络/">网络</a>, <a href="/tags/nat/">nat</a>, <a href="/tags/bridgedappter/">bridgedappter</a>
  </div>

        
  <div class="addthis addthis_toolbox addthis_default_style">
    
      <a class="addthis_button_facebook_like" fb:like:layout="button_count"></a>
    
    
      <a class="addthis_button_tweet"></a>
    
    
      <a class="addthis_button_google_plusone" g:plusone:size="medium"></a>
    
    
      <a class="addthis_button_pinterest_pinit" pi:pinit:layout="horizontal"></a>
    
    <a class="addthis_counter addthis_pill_style"></a>
  </div>
  <script type="text/javascript" src="http://s7.addthis.com/js/300/addthis_widget.js"></script>

      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>


<section id="comment">
  <h1 class="title">留言</h1>
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>
</div></div>
    <aside id="sidebar" class="alignright">
<div class="search">
  <form action="http://google.com/search" method="get" accept-charset="utf-8">
    <input type="text" name="q" results="0" placeholder="搜索">
    <input type="hidden" name="q" value="site:villadora.github.io">
  </form>
</div>


<div class="widget social">  
  <h3 class="title">链接</h3>
  <ul>
  <li>
    <a class="github" href="http://github.com/villadora">github</a>
  </li>
  <li>
    <a class="twitter" href="http://twitter.com/villadora">twitter</a>
  </li>
  <li>
    <a class="douban" href="http://www.douban.com/people/villadora">douban</a>
  </li>
  </ul>
</div>



<div class="widget tag">
  <h3 class="title">分类</h3>
  <ul class="entry">
  
    <li><a href="/categories/编译器/">编译器</a><small>1</small></li>
  
    <li><a href="/categories/C++/">C++</a><small>1</small></li>
  
    <li><a href="/categories/DotNet/">DotNet</a><small>1</small></li>
  
    <li><a href="/categories/Web/">Web</a><small>2</small></li>
  
    <li><a href="/categories/Web/HTML5/">HTML5</a><small>1</small></li>
  
    <li><a href="/categories/Nodejs/">Nodejs</a><small>1</small></li>
  
  </ul>
</div>



<div class="widget tag">
  <h3 class="title">标签</h3>
  <ul class="entry">
  
    <a href="/tags/Games/"><li>Games<small>1</small></li></a>
  
    <a href="/tags/rubik's cube/"><li>rubik&#39;s cube<small>1</small></li></a>
  
    <a href="/tags/rubic, cube/"><li>rubic, cube<small>1</small></li></a>
  
    <a href="/tags/computer/"><li>computer<small>1</small></li></a>
  
    <a href="/tags/compiler/"><li>compiler<small>1</small></li></a>
  
    <a href="/tags/SSA/"><li>SSA<small>1</small></li></a>
  
    <a href="/tags/C++/"><li>C++<small>1</small></li></a>
  
    <a href="/tags/smart point/"><li>smart point<small>1</small></li></a>
  
    <a href="/tags/c#/"><li>c#<small>1</small></li></a>
  
    <a href="/tags/notes/"><li>notes<small>1</small></li></a>
  
    <a href="/tags/笔记/"><li>笔记<small>1</small></li></a>
  
    <a href="/tags/dotnet/"><li>dotnet<small>1</small></li></a>
  
    <a href="/tags/web, mobile/"><li>web, mobile<small>1</small></li></a>
  
    <a href="/tags/html5/"><li>html5<small>1</small></li></a>
  
    <a href="/tags/web/"><li>web<small>1</small></li></a>
  
    <a href="/tags/barcamp/"><li>barcamp<small>1</small></li></a>
  
    <a href="/tags/shanghai/"><li>shanghai<small>1</small></li></a>
  
    <a href="/tags/虚拟机/"><li>虚拟机<small>1</small></li></a>
  
    <a href="/tags/virtualbox/"><li>virtualbox<small>1</small></li></a>
  
    <a href="/tags/网络/"><li>网络<small>1</small></li></a>
  
    <a href="/tags/nat/"><li>nat<small>1</small></li></a>
  
    <a href="/tags/bridgedappter/"><li>bridgedappter<small>1</small></li></a>
  
    <a href="/tags/graphviz/"><li>graphviz<small>1</small></li></a>
  
    <a href="/tags/图形学/"><li>图形学<small>1</small></li></a>
  
    <a href="/tags/layout/"><li>layout<small>1</small></li></a>
  
    <a href="/tags/读书/"><li>读书<small>2</small></li></a>
  
    <a href="/tags/历史/"><li>历史<small>1</small></li></a>
  
    <a href="/tags/程序员/"><li>程序员<small>1</small></li></a>
  
    <a href="/tags/经济/"><li>经济<small>2</small></li></a>
  
    <a href="/tags/专业化/"><li>专业化<small>1</small></li></a>
  
    <a href="/tags/读后感/"><li>读后感<small>1</small></li></a>
  
    <a href="/tags/思维方式/"><li>思维方式<small>1</small></li></a>
  
    <a href="/tags/分析/"><li>分析<small>1</small></li></a>
  
    <a href="/tags/学习/"><li>学习<small>1</small></li></a>
  
    <a href="/tags/全球化/"><li>全球化<small>1</small></li></a>
  
    <a href="/tags/泡沫/"><li>泡沫<small>1</small></li></a>
  
    <a href="/tags/经济,股市,发行审核制度/"><li>经济,股市,发行审核制度<small>1</small></li></a>
  
    <a href="/tags/编程, Ruby, slice, stackoverflow/"><li>编程, Ruby, slice, stackoverflow<small>1</small></li></a>
  
    <a href="/tags/IDE, Eclipse, Orion, Web/"><li>IDE, Eclipse, Orion, Web<small>1</small></li></a>
  
    <a href="/tags/IE7, bugs/"><li>IE7, bugs<small>1</small></li></a>
  
    <a href="/tags/javascript/"><li>javascript<small>4</small></li></a>
  
    <a href="/tags/synchronize/"><li>synchronize<small>1</small></li></a>
  
    <a href="/tags/git, customize/"><li>git, customize<small>1</small></li></a>
  
    <a href="/tags/nodejs, chil_process, spawn, exec/"><li>nodejs, chil_process, spawn, exec<small>1</small></li></a>
  
    <a href="/tags/type/"><li>type<small>1</small></li></a>
  
    <a href="/tags/prototype/"><li>prototype<small>1</small></li></a>
  
    <a href="/tags/javascript, ast, parse, minification/"><li>javascript, ast, parse, minification<small>1</small></li></a>
  
    <a href="/tags/emacs, auto-mode/"><li>emacs, auto-mode<small>1</small></li></a>
  
    <a href="/tags/mac, linux/"><li>mac, linux<small>1</small></li></a>
  
    <a href="/tags/hexo, interupt/"><li>hexo, interupt<small>1</small></li></a>
  
    <a href="/tags/svg, web, spec/"><li>svg, web, spec<small>1</small></li></a>
  
    <a href="/tags/javascript, Array.push, push, Range Error/"><li>javascript, Array.push, push, Range Error<small>1</small></li></a>
  
    <a href="/tags/passport/"><li>passport<small>1</small></li></a>
  
    <a href="/tags/openid/"><li>openid<small>1</small></li></a>
  
    <a href="/tags/nodejs/"><li>nodejs<small>1</small></li></a>
  
    <a href="/tags/cluster/"><li>cluster<small>1</small></li></a>
  
    <a href="/tags/mobile/"><li>mobile<small>1</small></li></a>
  
    <a href="/tags/android/"><li>android<small>1</small></li></a>
  
    <a href="/tags/iscroll/"><li>iscroll<small>1</small></li></a>
  
  </ul>
</div>

</aside>
    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><div class="alignleft">
  
  &copy; 2014 Villa Dora
  
  <br />
  Powered by <a href="http://zespia.tw/hexo/">Hexo</a>
</div>
<div class="alignright license">
<img alt="知识共享许可协议" style="border-width:0" src="http://i.creativecommons.org/l/by-nc-sa/3.0/88x31.png" /> 本站作品采用<a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/deed.zh">知识共享署名-非商业性使用-相同方式共享 3.0 未本地化版本许可协议</a>进行许可。
</div>
<div class="clearfix"></div>
</footer>
  <script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>


<script type="text/javascript">
var disqus_shortname = 'villadora-blog';

(function(){
  var dsq = document.createElement('script');
  dsq.type = 'text/javascript';
  dsq.async = true;
  dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
}());
</script>



<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>

</body>
</html>